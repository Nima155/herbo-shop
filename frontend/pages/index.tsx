import type { GetServerSideProps, NextPage } from 'next'
import Head from 'next/head'
import { dehydrate, QueryClient } from 'react-query'
import Layout from '../components/Layout'
import LoadingDots from '../components/LoadingDots'
import queries from '../lib/graphql'
import { authenticatedGraphQl } from '../lib/helpers'

const Home: NextPage = () => {
	return (
		<div>
			<Head>
				<title>herbal medicine | Herboca</title>
				<meta name="description" content="Generated by create next app" />
				<link rel="icon" href="/favicon.ico" />
			</Head>
			<Layout />

			<main></main>
		</div>
	)
}

export const getServerSideProps: GetServerSideProps = async (context) => {
	const gqlClient = authenticatedGraphQl(context.req.cookies)

	const queryClient = new QueryClient()
	const { USER_INFO } = queries

	await queryClient.prefetchQuery('user_stats', async () => {
		const data_1 = gqlClient.request(USER_INFO)
		return data_1
	})

	return {
		props: {
			dehydratedState: dehydrate(queryClient),
		},
	}
}

export default Home
